国密双证书

通常我们使用HTTPS访问网站时，客户端服务器协商的都是国际通用算法，使用的也是单证书体系，即服务器只需要提供一个签名证书用于向客户端证明自己的身份。但国密规范标准规定，基于国密算法的应用使用国密的双证书体系，双证书包括签名证书与加密证书，签名证书用于身份验证，加密证书用于秘钥交换。

在单向认证的情况下，如果双方协商为国密算法套件，则服务器方应该具有签名证书，加密证书，签名私钥，加密私钥。

在双向认证的情况下，如果双方协商为国密算法套件，则客户端服务器都应该具有各自的签名证书，加密证书，签名私钥，加密私钥。

基于国密双证书的握手协议
不同于普通的SSL协议握手过程，基于国密双证书的SSL协议握手包括如下步骤：

1）客户端发送HELLO消息，包括协议版本，会话标识，密码套件，随机数等属性。
2）如果能从客户端HELLO消息中找到与自身所持证书类型匹配的密码套件，服务器端发送SERVER HELLO消息作为对客户端HELLO消息的回复。
3）服务端必须发送一个SERVER CERTIFICATE消息给客户端，该消息紧跟在SERVER HELLO 消息之后，内容为服务端的签名证书和加密证书，即双证书。
4）紧接着服务端要发送SERVER KEY EXCHANGE消息。
5）如果服务端要求认证客户端，则应该发送CERTIFICATE REQUEST消息，要求客户端发送自己的证书。该消息紧跟在服务端秘钥交换消息之后，不要求认证客户端则不需要发送此消息。
6）服务端发送SEVER HELLO DONE消息，表示握手过程的HELLO消息阶段完成。
7）如果服务端请求客户端证书，客户端应该发送CLIENT CERTIFICATE消息，客户端证书消息与服务端证书消息结构相同，内容包括客户端的双证书。
8）如果服务端请求客户端证书，则CLIENT KEY EXCHANGE消息紧跟于客户端证书消息之后，否则客户端秘钥交换消息是客户端接收到服务端HELLO完成消息后所发送的第一条消息。
9）当需要发送CLIENT CERTIFICATE消息时，才会发送CERTIFICATE VERIFY消息。
10）客户端服务端各自发送密码规格变更消息，FINISHED消息。
