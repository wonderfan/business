# 2018-10-08

先从目录上进行划分，然后再从目录中的文件一个一个的审查；在阅读每个文件的时候，先从它的内容结构和轮廓图入手，对文件的里面的内容有个概略上的把握和认识。api目录中的内容主要是在接口的输入和输出数据模型的描述和定义；数据模型多的原因是因为业务的处理的面比较广。

Fabric ca sever的启动采用的main方法的形式，借助server cmd结构体对象和配置对象的帮助来完成这个过程。在cmd的独自目录和独立的结构体对象中，与lib目录中定义的配置对象和server结构体产生了联系，相互之间暗通曲款；互相的拉拢，从而产生了互动的交集。里面大多数是函数的运算和文件的读写操作；

在对区块的处理过程中，涉及到对区块的验证的功能；这个功能的实现沿用固有的接口和实现结构体的思路；验证的实现结构体完成了从消息信封到配置更新信封的转变；在它的一个方法中做了很多琐碎和细化的工作；譬如验证是否有权限，处理通道组的映射；到最后生成一个完整全新的结构体子元素和母元素。子元素的结构体对象上有一个序列的字段；生成一个新的时候，这个序列自动增加。

# 2018-10-09

信封是协议缓冲中的消息类型；实现的目标是两个协议缓冲之间的转换和构造。这两个消息的类型是有大小之分的，一个消息类型包裹另外一个消息类型。当采用面向对象编程的时候，代码的出现的位置和顺序已经不是影响的因素。接口定义的行为和契约。管理者的接口约定了管理者的行为和实现的职责；管理者可以达到的目的是建立起成员服务实例以及根据特定的条件获得成员服务实例的列表；msp的接口明确了一个msp实例具有的方法结合，以及通过每个方法可以实现的目标；在本地的文件系统中寻找msp，根据提供的角色的名称；将角色的字符串以及go语言对象的表达形式转变成字节数组的形式。分别从目录中读取文件，依次将文件的内容变成对象的字段或者属性。这就变成了一个msp的配置的数据来源和形成方式。msp独立成章；实现了msp既定要求的任务；在一个单独的空间中存活相关的代码。

启动的过程也从配置说起；那个总的配置对象红其实涵盖了多个方面的配置信息；现在仅仅的关注msp这个维度的配置信息。

# 2018-10-10

安全的状态机符志算法，以多个验证节点开始；在提交之前，验证节点需要进行两轮的投票；共识的部分有三个组件：提案，投票和锁定。

检查一下事务开始后，有没有新提交改变，如果没有就提交，如果有就放弃并重试。乐观并发控制类似自选锁。乐观并发控制适用于低数据争用，写冲突比较少的环境

具体来说，MVCC 克服了先前基于表和行的锁定机制为主要手段的事务模式所存在的读写相互阻塞弊端，它是一种无锁的读写互不阻塞的并发控制机制，采用了每个数据都有多个版本，数据版本冲突等到事务提交的时候检查一下事务开始后，有没有新提交改变数据版本，如果没有就提交，如果有就放弃提交。这种行为模式也被称为乐观锁，相对宽松的乐观锁，允许多个操作同时进行，在没有数据冲突以及数据冲突较少的情况下，很容易获得较好的并发性能和处理效率。

把每个消息写入到日志文件中，以便于重放这些消息。点对点的协议包括配置，连接，节点。
